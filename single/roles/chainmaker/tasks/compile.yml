- name: GOPATH
  ansible.builtin.import_tasks: gopath.yml
  tags: clone
- name: Chainmaker项目clone
  ansible.builtin.git:
    repo: "https://{{ chainmaker.username | urlencode }}:{{ chainmaker.password | urlencode }}@{{ chainmaker.repo }}"
    dest: "{{ workspace.compile }}/{{ chainmaker.name }}"
    version: "{{ chainmaker.version }}"
    force: true
    depth: 1
    single_branch: true
  tags: clone
- name: 编译脚本拷贝
  ansible.builtin.template:
    src: compile.sh.j2
    dest: "{{ workspace.compile }}/{{ chainmaker.name }}/compile.ansible.sh"
    mode: 0755
  tags: [clone]
- name: 编译
  ansible.builtin.command: ./compile.ansible.sh
  args:
    chdir: "{{ workspace.compile }}/{{ chainmaker.name }}"
  register: result
  changed_when: true
  tags: compile_bin
- name: Show Logs
  ansible.builtin.debug:
    msg: "{{ result.stdout_lines }}"
  tags: compile_bin
